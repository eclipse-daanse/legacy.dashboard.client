var oe=Object.defineProperty;var se=(p,e,t)=>e in p?oe(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var c=(p,e,t)=>(se(p,typeof e!="symbol"?e+"":e,t),t);import{e as g,r as re,d as j,v as ie,f as V,o as w,g as z,k as h,p as L,F as O,j as T,s as le,C as ue,t as X,y as ce,z as de,u as pe,D as me,A as q,w as R,x as ge}from"./vue.esm-bundler-e31f75a1.js";import"./lodash-9252d092.js";import{c as fe,X as he}from"./xml-8dd523f5.js";import{v as H}from"./v4-4a60fe23.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import"./_commonjsHelpers-725317a4.js";let N=class{constructor(e,t,u){c(this,"url",null);c(this,"id",null);c(this,"caption",null);c(this,"type","REST");this.id=e,this.url=t,this.caption=u}async getData(e){return await(await fetch(`${this.url}${e}`)).json()}getState(){return{id:this.id,url:this.url,caption:this.caption,type:this.type}}};class b{constructor(e,t="https://datacube-stage.nomad-dmz.jena.de/cube/xmla",u){c(this,"url","");c(this,"id",null);c(this,"caption",null);c(this,"type","XMLA");c(this,"client");c(this,"api",null);c(this,"tmpMDX",`SELECT
  Hierarchize(AddCalculatedMembers({[Geschlecht.Geschlecht (m/w/d)].[(All)].members})) DIMENSION PROPERTIES PARENT_UNIQUE_NAME,HIERARCHY_UNIQUE_NAME ON 1,
  Hierarchize(AddCalculatedMembers({[Jahr].[Jahr].members})) DIMENSION PROPERTIES PARENT_UNIQUE_NAME,HIERARCHY_UNIQUE_NAME ON 0
  FROM [BevÃ¶lkerung] CELL PROPERTIES VALUE, FORMAT_STRING, LANGUAGE, BACK_COLOR, FORE_COLOR, FONT_FLAGS`);this.id=e,this.url=t,this.caption=u,(async()=>{this.client=await fe("def/xmla.wsdl"),this.client.setEndpoint(t),console.log(t),this.api=new he(this.client,t),await this.api.startSession()})()}async getData(e=this.tmpMDX){var u;return console.log(e),await((u=this.api)==null?void 0:u.getMDX(e))}getState(){return{id:this.id,url:this.url,caption:this.caption,type:this.type}}}const v=g(new Map);function ve(){return{initDatasource:(a,s,o)=>{const n=H();if(console.log("Datasource should be inited"),a==="REST"){const m=new N(n,s,o);v.value.set(n,m)}if(a==="XMLA"){const m=new b(n,void 0,o);v.value.set(n,m)}return n},getDatasource:a=>v.value.get(a),getDatasourceList:()=>v,updateDatasource:(a,s,o,n)=>{if(s==="REST"){const m=new N(a,n,o);v.value.set(a,m)}if(s==="XMLA"){const m=new b(a,void 0,o);v.value.set(a,m)}},getSerializedState:()=>{const a={};return v.value.forEach(s=>{a[s.id]=s.getState()}),JSON.stringify(a)},loadState:a=>{Object.keys(a).forEach(s=>{const o=a[s];if(o.type==="REST"){const n=new N(o.id,o.url,o.caption);v.value.set(s,n)}if(o.type==="XMLA"){const n=new b(o.id,o.url,o.caption);v.value.set(s,n)}}),console.log(v.value)}}}class W{constructor(e,t,u){c(this,"caption","");c(this,"id","");c(this,"datasourceIds",[]);c(this,"datasourceManager");c(this,"data",null);c(this,"eventBus",null);c(this,"params",{});c(this,"requestTemplate","");c(this,"events",[]);c(this,"initedEvents",[]);c(this,"runtimeParams",{});this.id=e,this.caption=t,this.datasourceManager=ve(),this.eventBus=u,this.requestTemplate="/products/{pageNum}",this.calculateParams()}calculateParams(){const e={...this.params};this.params={},(this.requestTemplate.match(/[^{}]+(?=})/g)||[]).forEach(u=>{this.params[u]=e[u]||null}),this.runtimeParams={...this.params},console.log(this.params)}updateParam(e,t){this.params[e]=t,this.runtimeParams[e]=t,this.eventBus.emit(`UPDATE:${this.id}`)}addDatasource(e){this.datasourceIds.push(e)}setDatasources(e){this.datasourceIds=[...e],this.eventBus.emit(`UPDATE:${this.id}`)}async getData(){let e=this.requestTemplate;const t=this.datasourceManager.getDatasource(this.datasourceIds[0]);Object.keys(this.params).forEach(r=>{console.log(r),e=e.replace(`{${r}}`,this.runtimeParams[r])});const f=await(t==null?void 0:t.getData(e));return this.data=f,f}setOptions({caption:e="",requestTemplate:t=""}){this.caption=e,this.requestTemplate=t,this.calculateParams(),console.log("EMITED UPDATE",this.id),this.eventBus.emit(`UPDATE:${this.id}`)}updateEvents(e){console.log(e),this.initedEvents.forEach(t=>{this.eventBus.off(t.name,t.cb)}),this.initedEvents=[],this.events=e,e.forEach(t=>{const u=f=>{const r=Object.keys(this.runtimeParams),a=Object.values(this.runtimeParams),o=Function(...r,"$value",`
            console.log(arguments)
            ${t.action};
            return arguments;
          `)(...a,f);r.forEach((n,m)=>{this.runtimeParams[n]=o[m]}),this.eventBus.emit(`UPDATE:${this.id}`)};this.eventBus.on(t.name,u),this.initedEvents.push({name:t.name,cb:u})})}getState(){return{caption:this.caption,id:this.id,requestTemplate:this.requestTemplate,events:this.events,datasourceIds:this.datasourceIds,params:this.params}}loadState(e){this.caption=e.caption,this.id=e.id,this.requestTemplate=e.requestTemplate,this.events=e.events,this.datasourceIds=e.datasourceIds,this.params=e.params,this.calculateParams(),this.updateEvents(this.events)}}const E=g(new Map);function Q(){return{initStore:(r="NO CAPTION",a)=>{console.log(a);const s=H(),o=re(new W(s,r,a));return console.log("inited"),E.value.set(s,o),s},getStore:r=>{const a=E.value.get(r);if(a)return a;throw new Error("Store with provided id doesn't exist")},getStoreList:()=>E,getSerializedState:()=>{const r={};return E.value.forEach(a=>{r[a.id]=a.getState()}),JSON.stringify(r)},loadState:(r,a)=>{E.value.clear(),Object.keys(r).forEach(s=>{const o=new W(s,r[s].caption,a);o.loadState(r[s]),E.value.set(s,o)}),console.log(E.value)}}}const Se=p=>(ce("data-v-b4c78645"),p=p(),de(),p),xe={class:"settings-container"},Ae={class:"settings-container"},Ee=Se(()=>T("h3",{class:"mb-2"},"Select store",-1)),_e={class:"response"},J=j({__name:"TextWidgetSettings",props:["component"],setup(p){const e=p,t=g({textSection:!1,storeSection:!1}),u=Q();let f=g([]);const r=g(""),a=g(e.component.storeId),s=()=>{const m=u.getStoreList();f.value=Array.from(m.value,function(l){return{...l[1]}})},o=async()=>{const l=await u.getStore(a.value).getData();r.value=JSON.stringify(l,null,2)},n=m=>{a.value=m,e.component.storeId=m,o()};return ie(()=>{s(),a.value&&o()}),(m,l)=>{const S=V("va-input"),x=V("va-select"),A=V("va-collapse"),_=V("va-radio");return w(),z(O,null,[h(A,{modelValue:t.value.textSection,"onUpdate:modelValue":l[7]||(l[7]=i=>t.value.textSection=i),header:"Text widget settings"},{default:L(()=>[T("div",xe,[h(S,{modelValue:e.component.text,"onUpdate:modelValue":l[0]||(l[0]=i=>e.component.text=i),label:"Text"},null,8,["modelValue"]),h(S,{modelValue:e.component.fontSize,"onUpdate:modelValue":l[1]||(l[1]=i=>e.component.fontSize=i),label:"Font Size"},null,8,["modelValue"]),h(S,{modelValue:e.component.fontColor,"onUpdate:modelValue":l[2]||(l[2]=i=>e.component.fontColor=i),label:"Font Color"},null,8,["modelValue"]),h(S,{modelValue:e.component.fontWeight,"onUpdate:modelValue":l[3]||(l[3]=i=>e.component.fontWeight=i),label:"Font Weight"},null,8,["modelValue"]),h(x,{modelValue:e.component.textDecoration,"onUpdate:modelValue":l[4]||(l[4]=i=>e.component.textDecoration=i),label:"Text decoration",options:["Underline solid","Underline dashed","Underline wavy","Line-through","Overline","None"]},null,8,["modelValue"]),h(x,{modelValue:e.component.horizontalAlign,"onUpdate:modelValue":l[5]||(l[5]=i=>e.component.horizontalAlign=i),label:"Horizontal align",options:["Left","Center","Right"]},null,8,["modelValue"]),h(x,{modelValue:e.component.verticalAlign,"onUpdate:modelValue":l[6]||(l[6]=i=>e.component.verticalAlign=i),label:"Vertical align",options:["Top","Center","Bottom"]},null,8,["modelValue"])])]),_:1},8,["modelValue"]),h(A,{modelValue:t.value.storeSection,"onUpdate:modelValue":l[8]||(l[8]=i=>t.value.storeSection=i),header:"Store settings"},{default:L(()=>[T("div",Ae,[T("div",null,[Ee,(w(!0),z(O,null,le(ue(f),i=>(w(),z("div",{class:"mb-2",key:i.id},[h(_,{"model-value":a.value,"onUpdate:modelValue":n,option:{text:`${i.caption} ${i.id}`,id:i.id},"value-by":"id",name:"store-radio-group"},null,8,["model-value","option"])]))),128)),T("pre",_e,X(r.value),1)])])]),_:1},8,["modelValue"])],64)}}});const Te=G(J,[["__scopeId","data-v-b4c78645"]]);J.__docgenInfo={exportName:"default",displayName:"TextWidgetSettings",description:"",tags:{},props:[{name:"component",type:{name:"undefined"}}],sourceFiles:["/home/markus/dev/xmla_slava/XMLAClient/src/components/Widgets/Text/TextWidgetSettings.vue"]};const De={class:"component"},k=j({__name:"TextWidget",props:{initialState:{type:Object,required:!1},text:{type:String,required:!1,default:""},fontSize:{type:Number,required:!1,default:12},fontColor:{type:String,required:!1,default:"#000"},fontWeight:{type:String,required:!1,default:"normal"},textDecoration:{type:String,required:!1,default:"None"},horizontalAlign:{type:String,required:!1,default:"Left"},verticalAlign:{type:String,required:!1,default:"Top"}},setup(p,{expose:e}){pe(d=>({"2a154f64":S.value+"px","7d70dcb6":x.value,"6ef515d2":y.value,ed85af14:A.value,"11a0e166":K.value}));const t=Te,u=me("customEventBus"),f=Q(),r=g(""),a=g(null);let s=null;const o=p,{initialState:n,text:m}=o,l=g((n==null?void 0:n.text)||m||""),S=g((n==null?void 0:n.fontSize)||o.fontSize||12),x=g((n==null?void 0:n.fontColor)||o.fontColor||"#000"),A=g((n==null?void 0:n.fontWeight)||o.fontWeight||"normal"),_=g((n==null?void 0:n.textDecoration)||o.textDecoration||"None"),i=g((n==null?void 0:n.verticalAlign)||o.verticalAlign||"Top"),y=g((n==null?void 0:n.horizontalAlign)||o.horizontalAlign||"Left"),Y=()=>({text:l.value,fontSize:S.value,fontColor:x.value,fontWeight:A.value,textDecoration:_.value,verticalAlign:i.value,horizontalAlign:y.value,storeId:r.value}),U=d=>{l.value=d.text,S.value=d.fontSize,x.value=d.fontColor,A.value=d.fontWeight,_.value=d.textDecoration,i.value=d.verticalAlign,y.value=d.horizontalAlign},K=q(()=>{switch(_.value){case"Underline solid":return"underline solid";case"Underline dashed":return"underline dashed";case"Underline wavy":return"underline wavy";case"Line-through":return"line-through";case"Overline":return"overline";default:return"none"}});e({text:l,fontSize:S,fontColor:x,fontWeight:A,textDecoration:_,horizontalAlign:y,verticalAlign:i,storeId:r,settings:t,getState:Y,setState:U});const Z=async()=>{s&&I()};R(()=>o,d=>{U(d)},{deep:!0}),R(r,(d,D)=>{console.log("store changed",r),s=f.getStore(r.value),console.log(D,d),u.off(`UPDATE:${D}`,I),u.on(`UPDATE:${r.value}`,I),Z()});const I=async()=>{a.value=await(s==null?void 0:s.getData()),console.log(a)},ee=q(()=>{let d=l.value;const D=/{(.*?)}/g,P=d.match(D);return!P||!a.value||P.forEach(M=>{const te=M.replace("{","").replace("}","").split(".").reduce((ae,ne)=>ae[ne],a.value);d=d.replace(M,te)}),d});return(d,D)=>(w(),z("div",{class:"text-container",style:ge({"justify-content":i.value==="Top"?"flex-start":i.value==="Center"?"center":"flex-end"})},[T("div",De,X(ee.value),1)],4))}});const ye=G(k,[["__scopeId","data-v-08678a10"]]);k.__docgenInfo={exportName:"default",displayName:"TextWidget",description:"",tags:{},expose:[{name:"text"},{name:"fontSize"},{name:"fontColor"},{name:"fontWeight"},{name:"textDecoration"},{name:"horizontalAlign"},{name:"verticalAlign"},{name:"storeId"},{name:"settings"},{name:"getState"},{name:"setState"}],props:[{name:"initialState",type:{name:"object"},required:!1},{name:"text",type:{name:"string"},required:!1,defaultValue:{func:!1,value:'""'}},{name:"fontSize",type:{name:"number"},required:!1,defaultValue:{func:!1,value:"12"}},{name:"fontColor",type:{name:"string"},required:!1,defaultValue:{func:!1,value:'"#000"'}},{name:"fontWeight",type:{name:"string"},required:!1,defaultValue:{func:!1,value:'"normal"'}},{name:"textDecoration",type:{name:"string"},required:!1,defaultValue:{func:!1,value:'"None"'}},{name:"horizontalAlign",type:{name:"string"},required:!1,defaultValue:{func:!1,value:'"Left"'}},{name:"verticalAlign",type:{name:"string"},required:!1,defaultValue:{func:!1,value:'"Top"'}}],sourceFiles:["/home/markus/dev/xmla_slava/XMLAClient/src/components/Widgets/Text/TextWidget.vue"]};const Le={title:"Widget/StaticWidgets/Text",component:ye,tags:["autodocs"]},C={args:{text:"Qwe",fontSize:24,fontColor:"white",fontWeight:"bold",textDecoration:"None",horizontalAlign:"Center",verticalAlign:"Center"}};var F,$,B;C.parameters={...C.parameters,docs:{...(F=C.parameters)==null?void 0:F.docs,source:{originalSource:`{
  args: {
    text: "Qwe",
    fontSize: 24,
    fontColor: "white",
    fontWeight: "bold",
    textDecoration: "None",
    horizontalAlign: "Center",
    verticalAlign: "Center"
  }
}`,...(B=($=C.parameters)==null?void 0:$.docs)==null?void 0:B.source}}};const Oe=["Primary"];export{C as Primary,Oe as __namedExportsOrder,Le as default};
